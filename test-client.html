<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Socket.IO Test Client</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      .container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }
      .panel {
        border: 1px solid #ccc;
        padding: 15px;
        border-radius: 5px;
      }
      .log {
        background-color: #f5f5f5;
        height: 300px;
        overflow-y: auto;
        padding: 10px;
        font-family: monospace;
        font-size: 12px;
      }
      input,
      button {
        margin: 5px 0;
        padding: 5px;
      }
      button {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 3px;
        cursor: pointer;
      }
      button:hover {
        background-color: #0056b3;
      }
      .connected {
        color: green;
      }
      .disconnected {
        color: red;
      }
    </style>
  </head>
  <body>
    <h1>Socket.IO Test Client</h1>

    <div class="container">
      <div class="panel">
        <h3>Connection</h3>
        <div>
          <label>User ID: <input type="text" id="userId" value="user1" /></label
          ><br />
          <label
            >Nickname:
            <input type="text" id="nickname" value="테스트유저1" /></label
          ><br />
          <label
            >Room ID:
            <input type="text" id="roomId" value="test-room-1" /></label
          ><br />
          <button onclick="connect()">Connect</button>
          <button onclick="disconnect()">Disconnect</button>
        </div>
        <div id="connectionStatus" class="disconnected">Disconnected</div>
      </div>

      <div class="panel">
        <h3>Room Actions</h3>
        <button onclick="joinRoom()">Join Room</button>
        <button onclick="leaveRoom()">Leave Room</button>
        <br /><br />
        <div>
          <label
            >Message:
            <input
              type="text"
              id="message"
              placeholder="Enter message" /></label
          ><br />
          <button onclick="sendMessage()">Send Message</button>
        </div>
      </div>
    </div>

    <div class="panel">
      <h3>Event Log</h3>
      <div id="log" class="log"></div>
      <button onclick="clearLog()">Clear Log</button>
    </div>

    <script>
      let socket = null;

      function log(message) {
        const logDiv = document.getElementById('log');
        const timestamp = new Date().toLocaleTimeString();
        logDiv.innerHTML += `[${timestamp}] ${message}\n`;
        logDiv.scrollTop = logDiv.scrollHeight;
      }

      function updateConnectionStatus(connected) {
        const statusDiv = document.getElementById('connectionStatus');
        if (connected) {
          statusDiv.textContent = 'Connected';
          statusDiv.className = 'connected';
        } else {
          statusDiv.textContent = 'Disconnected';
          statusDiv.className = 'disconnected';
        }
      }

      function connect() {
        if (socket) {
          socket.disconnect();
        }

        socket = io('http://localhost:3000');

        socket.on('connect', () => {
          log('Connected to server');
          updateConnectionStatus(true);
        });

        socket.on('disconnect', () => {
          log('Disconnected from server');
          updateConnectionStatus(false);
        });

        socket.on('join-room', (userInfo) => {
          log(`User joined: ${userInfo.nickname} (${userInfo.userId})`);
        });

        socket.on('leave-room', (userInfo) => {
          log(`User left: ${userInfo.nickname} (${userInfo.userId})`);
        });

        socket.on('chat', (message) => {
          log(`Chat: ${message.nickname}: ${message.message}`);
        });

        socket.on('phase-change', (data) => {
          log(`Phase change: ${JSON.stringify(data)}`);
        });

        socket.on('phase-data', (data) => {
          log(`Phase data: ${JSON.stringify(data)}`);
        });
      }

      function disconnect() {
        if (socket) {
          socket.disconnect();
          socket = null;
        }
      }

      function joinRoom() {
        if (!socket) {
          log('Not connected to server');
          return;
        }

        const userId = document.getElementById('userId').value;
        const nickname = document.getElementById('nickname').value;
        const roomId = document.getElementById('roomId').value;

        socket.emit('join-room', {
          userId: userId,
          nickname: nickname,
          roomId: roomId,
        });

        log(`Joining room: ${roomId}`);
      }

      function leaveRoom() {
        if (!socket) {
          log('Not connected to server');
          return;
        }

        const userId = document.getElementById('userId').value;
        const nickname = document.getElementById('nickname').value;
        const roomId = document.getElementById('roomId').value;

        socket.emit('leave-room', {
          userId: userId,
          nickname: nickname,
          roomId: roomId,
        });

        log(`Leaving room: ${roomId}`);
      }

      function sendMessage() {
        if (!socket) {
          log('Not connected to server');
          return;
        }

        const message = document.getElementById('message').value;
        const userId = document.getElementById('userId').value;
        const nickname = document.getElementById('nickname').value;

        if (!message.trim()) {
          log('Message cannot be empty');
          return;
        }

        socket.emit('chat-message', {
          senderId: userId,
          nickname: nickname,
          message: message,
          timestamp: Date.now(),
          phase: 1,
        });

        document.getElementById('message').value = '';
        log(`Sent message: ${message}`);
      }

      function clearLog() {
        document.getElementById('log').innerHTML = '';
      }

      // Auto-connect on page load
      window.onload = function () {
        connect();
      };
    </script>
  </body>
</html>
